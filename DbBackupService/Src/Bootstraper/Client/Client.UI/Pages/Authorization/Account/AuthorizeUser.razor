@page "/authorizeuser"
@using Blazored.LocalStorage
@using Client.UI.Data.Interfaces
@using Client.UI.Data.Services
@using Client.UI.Pages.Components

@layout AuthLayout

@inject NavigationManager Nav
@inject AuthStateProvider Provider
@inject IAuthHttpClientService AuthService
@inject ILocalStorageService LocalStorage

<AuthorizingUserInfoComponent/>

@code {

    protected override async Task OnInitializedAsync()
    {
        var token = await LocalStorage.GetItemAsync<string>("TempToken");

        AuthService.UserToken!.Token = token;

        var authState = await Provider.GetAuthenticationStateAsync();
        AuthService.UserToken.Email = authState.User.Identity?.Name;

        await LocalStorage.RemoveItemAsync("TempToken");

        Nav.NavigateTo("/", false);
    }

}